<ng-container *ngIf="{ count: dataSource.getCount() | async, loading: dataSource.isLoading() | async } as data">
  <header>
    <h2>{{ header }}</h2>
    <div class="header-options">
      <div class="header-left-side">
        <a *ngIf="createButton" [href]="createButton.link">
          <app-cryton-button [value]="createButton.value" icon="add_circle" color="primary"></app-cryton-button>
        </a>
        <app-cryton-counter name="Total" [count]="data.count"></app-cryton-counter>
      </div>
      <form [formGroup]="filterOptions">
        <mat-form-field>
          <mat-label>Column</mat-label>
          <mat-select ngDefaultControl [formControl]="columnControl">
            <mat-option *ngFor="let column of getFilterableColumns()" [value]="column.name">
              {{ column.display | titlecase }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field id="search-bar">
          <mat-label>Search</mat-label>
          <input matInput ngDefaultControl type="text" [formControl]="filterControl" />
          <button
            mat-button
            *ngIf="filterControl.value"
            matSuffix
            mat-icon-button
            aria-label="Clear"
            (click)="filterControl.reset()"
          >
            <mat-icon>close</mat-icon>
          </button>
        </mat-form-field>
      </form>
    </div>
  </header>

  <table
    mat-table
    matSort
    (matSortChange)="sortData($event)"
    [hidden]="data.count === 0"
    [dataSource]="dataSource"
    [multiTemplateDataRows]="expandedComponent != null"
  >
    <!-- Displays all defined columns with their display names in the header -->
    <ng-container *ngFor="let column of dataSource.columns; index as i" matColumnDef="{{ column.name }}">
      <th mat-header-cell mat-sort-header [disabled]="!column.sortable" *matHeaderCellDef>{{ column.display }}</th>
      <td mat-cell *matCellDef="let item">
        <!-- Highlights columns with parameter highlight and transforms display values into correct form -->
        <span [ngClass]="getClass(item[column.name], column.highlight)" [matTooltip]="getTooltip(item, i, column.name)">
          {{ displayCell(item, i, column.name) | shortString: maxStringLength }}
        </span>
      </td>
    </ng-container>

    <!-- Displays buttons from buttons variable and appends functions to their click event -->
    <ng-container *ngIf="shouldShowButtons()" matColumnDef="buttons">
      <th mat-header-cell *matHeaderCellDef [ngStyle]="{ width: getButtonsWidth() }"></th>
      <td mat-cell *matCellDef="let item">
        <div class="buttons">
          <!-- CUSTOM BUTTONS -->
          <button
            mat-icon-button
            onclick="this.blur()"
            *ngFor="let button of buttons"
            (click)="handleButtonClick(button, item)"
          >
            <mat-icon [@error]="isErroneous(button, item) ? 'error' : 'noError'">{{ button.icon }}</mat-icon>
          </button>

          <!-- RADIO BUTTONS -->
          <mat-radio-button
            *ngIf="showRadioButtons"
            name="table-radio-group"
            color="primary"
            [checked]="isRadioChecked(item)"
            (change)="checkRadioButton(item)"
          >
          </mat-radio-button>

          <!-- CHECKBOES -->
          <mat-checkbox
            *ngIf="showCheckboxes"
            name="table-checkbox-group"
            color="primary"
            [checked]="isCheckboxChecked(item)"
            (change)="checkCheckbox(item)"
          >
          </mat-checkbox>

          <!-- ROW EXPAND ARROW -->
          <mat-icon
            *ngIf="expandedComponent"
            class="unselectable"
            [@expand]="expandedRow === item ? 'expanded' : 'collapsed'"
          >
            expand_more
          </mat-icon>
        </div>
      </td>
    </ng-container>

    <!-- EXPANDED ROW DETAIL-->
    <ng-container matColumnDef="expandedDetail">
      <td mat-cell *matCellDef="let row" [attr.colspan]="displayedColumns.length">
        <div class="row-detail" [@detailExpand]="row == expandedRow ? 'expanded' : 'collapsed'">
          <ng-template appComponentHost></ng-template>
        </div>
      </td>
    </ng-container>

    <!-- REGULAR ROWS -->
    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr
      mat-row
      *matRowDef="let row; columns: displayedColumns; let i = dataIndex"
      [ngClass]="{
        clickable: hasCheckboxXORradio() || expandedComponent,
        'cryton-table--expandable': expandedComponent
      }"
      (click)="handleRowClick(row, i)"
    ></tr>

    <!-- EXPANDED ROWS -->
    <ng-container *ngIf="expandedComponent">
      <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="cryton-table--expandable-row"></tr>
    </ng-container>
  </table>

  <!-- EMPTY TABLE -->
  <div class="empty-table" *ngIf="data.count === 0 && data.loading; else noResults">
    <mat-spinner></mat-spinner>
  </div>
  <ng-template #noResults>
    <div class="empty-table" *ngIf="data.count === 0">
      <h2>NO RESULTS FOUND</h2>
    </div>
  </ng-template>
</ng-container>

<div class="paginator">
  <mat-paginator
    [length]="dataSource.getCount() | async"
    [pageSize]="5"
    [pageSizeOptions]="[3, 5, 10]"
    [showFirstLastButtons]="true"
    [hidePageSize]="hidePageSize"
  >
  </mat-paginator>
</div>
